<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>购物车 | 小兔鲜儿</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="小兔鲜儿PC前台-开发文档">
    
    <link rel="preload" href="/erabbit-client-pc-document/assets/css/0.styles.bfb7a5cd.css" as="style"><link rel="preload" href="/erabbit-client-pc-document/assets/js/app.948bdee4.js" as="script"><link rel="preload" href="/erabbit-client-pc-document/assets/js/2.e30d490f.js" as="script"><link rel="preload" href="/erabbit-client-pc-document/assets/js/6.8b45773c.js" as="script"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/10.967a337a.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/11.695b6fd5.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/12.ef3d904c.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/13.203ca22a.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/14.e446ef51.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/15.240da5b5.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/16.a42caf07.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/17.ff63a27b.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/18.261777ab.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/3.2ebc11dd.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/4.0f8dcd9c.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/5.e91a9095.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/7.cc81a86f.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/8.0ee24dd1.js"><link rel="prefetch" href="/erabbit-client-pc-document/assets/js/9.5c3ae8a2.js">
    <link rel="stylesheet" href="/erabbit-client-pc-document/assets/css/0.styles.bfb7a5cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/erabbit-client-pc-document/" class="home-link router-link-active"><img src="/erabbit-client-pc-document/hero.png" alt="小兔鲜儿" class="logo"> <span class="site-name can-hide">小兔鲜儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/erabbit-client-pc-document/guide/00-vue3pre.html" class="nav-link">
  vue3前置
</a></div><div class="nav-item"><a href="/erabbit-client-pc-document/guide/01-intro.html" class="nav-link">
  项目介绍
</a></div><div class="nav-item"><a href="/erabbit-client-pc-document/guide/02-started.html" class="nav-link">
  项目起步
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能模块" class="dropdown-title"><span class="title">功能模块</span> <span class="arrow down"></span></button> <button type="button" aria-label="功能模块" class="mobile-dropdown-title"><span class="title">功能模块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/03-home.html" class="nav-link">
  首页模块
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/04-category.html" class="nav-link">
  分类模块
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/05-detail.html" class="nav-link">
  商品详情
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/06-login.html" class="nav-link">
  登录模块
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/07-cart.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  购物车
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/08-pay.html" class="nav-link">
  结算&amp;支付
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/09-member.html" class="nav-link">
  个人中心
</a></li></ul></div></div><div class="nav-item"><a href="/erabbit-client-pc-document/guide/10-end.html" class="nav-link">
  项目总结
</a></div> <a href="http://git.itcast.cn/zhousg/erabbit-client-pc-vue3" target="_blank" rel="noopener noreferrer" class="repo-link">
    Gitlab
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/erabbit-client-pc-document/guide/00-vue3pre.html" class="nav-link">
  vue3前置
</a></div><div class="nav-item"><a href="/erabbit-client-pc-document/guide/01-intro.html" class="nav-link">
  项目介绍
</a></div><div class="nav-item"><a href="/erabbit-client-pc-document/guide/02-started.html" class="nav-link">
  项目起步
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能模块" class="dropdown-title"><span class="title">功能模块</span> <span class="arrow down"></span></button> <button type="button" aria-label="功能模块" class="mobile-dropdown-title"><span class="title">功能模块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/03-home.html" class="nav-link">
  首页模块
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/04-category.html" class="nav-link">
  分类模块
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/05-detail.html" class="nav-link">
  商品详情
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/06-login.html" class="nav-link">
  登录模块
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/07-cart.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  购物车
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/08-pay.html" class="nav-link">
  结算&amp;支付
</a></li><li class="dropdown-item"><!----> <a href="/erabbit-client-pc-document/guide/09-member.html" class="nav-link">
  个人中心
</a></li></ul></div></div><div class="nav-item"><a href="/erabbit-client-pc-document/guide/10-end.html" class="nav-link">
  项目总结
</a></div> <a href="http://git.itcast.cn/zhousg/erabbit-client-pc-vue3" target="_blank" rel="noopener noreferrer" class="repo-link">
    Gitlab
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>购物车</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_01-购物车功能分析" class="sidebar-link">01-购物车功能分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_02-加入购物车-本地" class="sidebar-link">02-加入购物车-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_03-头部购物车-基础布局" class="sidebar-link">03-头部购物车-基础布局</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_04-头部购物车-商品列表-本地" class="sidebar-link">04-头部购物车-商品列表-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_05-头部购物车-删除操作-本地" class="sidebar-link">05-头部购物车-删除操作-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_06-购物车页面-基础布局" class="sidebar-link">06-购物车页面-基础布局</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_07-购物车页面-列表展示-本地" class="sidebar-link">07-购物车页面-列表展示-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_08-购物车页面-单选操作-本地" class="sidebar-link">08-购物车页面-单选操作-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_09-购物车页面-全选操作-本地" class="sidebar-link">09-购物车页面-全选操作-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_10-购物车页面-删除操作-本地" class="sidebar-link">10-购物车页面-删除操作-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_11-购物车页面-确认框组件" class="sidebar-link">11-购物车页面-确认框组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_12-购物车页面-批量删除-本地" class="sidebar-link">12-购物车页面-批量删除-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_13-购物车页面-无效商品-本地" class="sidebar-link">13-购物车页面-无效商品-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_14-购物车页面-修改数量-本地" class="sidebar-link">14-购物车页面-修改数量-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_15-购物车页面-修改规格-本地" class="sidebar-link">15-购物车页面-修改规格-本地</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_16-登录后-合并购物车" class="sidebar-link">16-登录后-合并购物车</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_17-登录后-商品列表" class="sidebar-link">17-登录后-商品列表</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_18-登录后-加入购物车" class="sidebar-link">18-登录后-加入购物车</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_19-登录后-删除操作" class="sidebar-link">19-登录后-删除操作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_20-登录后-批量删除" class="sidebar-link">20-登录后-批量删除</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_21-登录后-选中状态-修改数量" class="sidebar-link">21-登录后-选中状态&amp;修改数量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_22-登录后-全选反选" class="sidebar-link">22-登录后-全选反选</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_23-登录后-修改规格" class="sidebar-link">23-登录后-修改规格</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/erabbit-client-pc-document/guide/07-cart.html#_24-下单结算" class="sidebar-link">24-下单结算</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="购物车"><a href="#购物车" class="header-anchor">#</a> 购物车</h1> <h2 id="_01-购物车功能分析"><a href="#_01-购物车功能分析" class="header-anchor">#</a> 01-购物车功能分析</h2> <blockquote><p>目的：了解购物车两种状态下的操作逻辑，方便后续的开发理解。</p></blockquote> <p><img src="/erabbit-client-pc-document/assets/img/1614324821761.861aa767.png" alt="1614324821761"></p> <p>总结：</p> <ul><li>购物车的各种操作都会有两种状态的区分，但是不会在组件中去区分。</li> <li>而是在封装在vuex中的actions中去区分，在组件上只需调用actions即可。</li> <li>在actions中通过user信息去区分登录状态
<ul><li>未登录，通过mutations修改vuex中的数据即可，vuex已经实现持久化，会同步保持在本地。</li> <li>已登录，通过api接口去服务端操作，响应成功后通过mutations修改vuex中的数据即可，它也会同步在本地。</li></ul></li> <li>不管何种操作何种状态返回一个promise，然后组件能够判断操作是否完毕是否成功，再而去做其他事情。</li></ul> <p>注意：</p> <ul><li>登录后，需要合并本地购物车到服务端。</li> <li>退出后，清空vuex数据也会同步清空本地数据。</li></ul> <h2 id="_02-加入购物车-本地"><a href="#_02-加入购物车-本地" class="header-anchor">#</a> 02-加入购物车-本地</h2> <blockquote><p>目的：完成商品详情的添加购物车操作，支持未登录状态。</p></blockquote> <p>大致步骤：</p> <ul><li>约定本地存储的信息内容</li> <li>编写mutaions添加购物车逻辑</li> <li>编写actions进行添加操作</li> <li>在商品详情页实现添加逻辑</li></ul> <p>落地代码：</p> <ul><li>vuex中的修改数据，获取数据 <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 本地：id skuId name picture price nowPrice count attrsText selected stock isEffective</span>
  <span class="token comment">// 线上：比上面多 isCollect 有用 discount 无用 两项项信息</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">insertCart</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> goods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> sameIndex <span class="token operator">=</span> state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>skuId <span class="token operator">===</span> goods<span class="token punctuation">.</span>skuId<span class="token punctuation">)</span>
      <span class="token comment">// 逻辑：有相同的给goods累加数量，删除相同skuId的商品</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sameIndex <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        goods<span class="token punctuation">.</span>count <span class="token operator">=</span> state<span class="token punctuation">.</span>list<span class="token punctuation">[</span>sameIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>count <span class="token operator">+</span> goods<span class="token punctuation">.</span>count
        state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>sameIndex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>goods<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">insertCart</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> goods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 已登录 TODO</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 未登录</span>
          ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'insertCart'</span><span class="token punctuation">,</span> goods<span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>商品详情点击加入购物车 <code>src/views/goods/index.vue</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> setup () {
</span><span class="token prefix unchanged"> </span><span class="token line">   const goods = useGoods()
</span><span class="token prefix unchanged"> </span><span class="token line">   // sku改变时候触发
</span><span class="token prefix unchanged"> </span><span class="token line">   const changeSku = (sku) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">     if (sku.skuId) {
</span><span class="token prefix unchanged"> </span><span class="token line">       goods.value.price = sku.price
</span><span class="token prefix unchanged"> </span><span class="token line">       goods.value.oldPrice = sku.oldPrice
</span><span class="token prefix unchanged"> </span><span class="token line">       goods.value.inventory = sku.inventory
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        currSku.value = sku
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     } else {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        currSku.value = null
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line">   // 选择的数量
</span><span class="token prefix unchanged"> </span><span class="token line">   const num = ref(1)
</span><span class="token prefix unchanged"> </span><span class="token line">   // 加入购物车逻辑
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const currSku = ref(null)
</span><span class="token prefix inserted">+</span><span class="token line">   const instance = getCurrentInstance()
</span><span class="token prefix inserted">+</span><span class="token line">   const store = useStore()
</span><span class="token prefix inserted">+</span><span class="token line">   const insertCart = () =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">     if (!currSku.value) {
</span><span class="token prefix inserted">+</span><span class="token line">       return instance.proxy.$message('请选择商品规格')
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span><span class="token prefix inserted">+</span><span class="token line">     if (num.value &gt; goods.inventory) {
</span><span class="token prefix inserted">+</span><span class="token line">       return instance.proxy.$message('库存不足')
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span><span class="token prefix inserted">+</span><span class="token line">     store.dispatch('cart/insertCart', {
</span><span class="token prefix inserted">+</span><span class="token line">       id: goods.value.id,
</span><span class="token prefix inserted">+</span><span class="token line">       skuId: currSku.value.skuId,
</span><span class="token prefix inserted">+</span><span class="token line">       name: goods.value.name,
</span><span class="token prefix inserted">+</span><span class="token line">       picture: goods.value.mainPictures[0],
</span><span class="token prefix inserted">+</span><span class="token line">       price: currSku.value.price,
</span><span class="token prefix inserted">+</span><span class="token line">       nowPrice: currSku.value.price,
</span><span class="token prefix inserted">+</span><span class="token line">       count: num.value,
</span><span class="token prefix inserted">+</span><span class="token line">       attrsText: currSku.value.specsText,
</span><span class="token prefix inserted">+</span><span class="token line">       selected: true,
</span><span class="token prefix inserted">+</span><span class="token line">       isEffective: true,
</span><span class="token prefix inserted">+</span><span class="token line">       stock: currSku.value.inventory
</span><span class="token prefix inserted">+</span><span class="token line">     }).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">       instance.proxy.$message('加入购物车成功', 'success')
</span><span class="token prefix inserted">+</span><span class="token line">     })
</span><span class="token prefix inserted">+</span><span class="token line">   }
</span><span class="token prefix inserted">+</span><span class="token line">   return { goods, changeSku, num, insertCart }
</span><span class="token prefix inserted">+</span><span class="token line"> }
</span></span></code></pre></div><h2 id="_03-头部购物车-基础布局"><a href="#_03-头部购物车-基础布局" class="header-anchor">#</a> 03-头部购物车-基础布局</h2> <blockquote><p>目的：在网站头部购物车图片处，鼠标经过展示购物车列表。</p></blockquote> <p><img src="/erabbit-client-pc-document/assets/img/1614736222931.60b42d5c.png" alt="1614736222931"></p> <p>大致步骤：</p> <ul><li>提取头部购物车组件，完成基础布局。</li> <li>通过getters返回，有效商品总数，和有效商品列表。</li> <li>渲染组件。</li></ul> <p>落的代码：</p> <ul><li>新建组件 <code>src/components/app-header-cart.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'AppHeaderCart'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.cart</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 50px<span class="token selector">;
  .curr</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token selector">;
    .icon-cart</span> <span class="token punctuation">{</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 22px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">em</span> <span class="token punctuation">{</span>
      <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 1px 6px<span class="token punctuation">;</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@helpColor</span><span class="token punctuation">;</span></span>
      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>使用组件，和<strong>删除迁移过的代码</strong> <code>src/components/app-header.vue</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     &lt;div class=&quot;search&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;i class=&quot;iconfont icon-search&quot;&gt;&lt;/i&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;input type=&quot;text&quot; placeholder=&quot;搜一搜&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;/div&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      &lt;AppHeaderCart /&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line"> &lt;/header&gt;
</span></span><span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line">/template&gt;
</span></span>
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line">script&gt;
</span></span>import AppHeaderNav from './app-header-nav'
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import AppHeaderCart from './app-header-cart'
</span></span>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> name: 'AppHeader',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  components: { AppHeaderNav, AppHeaderCart }
</span></span>}
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line">/script&gt;
</span></span></code></pre></div><ul><li>基础布局和弹出效果  <code>src/components/app-header-cart.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>layer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i in 4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouterLink</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://yanxuan-item.nosdn.127.net/ead73130f3dbdb3cabe1c7b0f4fd3d28.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name ellipsis-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>和手足干裂说拜拜 ingrams手足皲裂修复霜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr ellipsis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>颜色：修复绿瓶 容量：150ml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>price<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>45.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>x2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RouterLink</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-close-new<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foot<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>共 3 件商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>135.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>plain<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去购物车结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'AppHeaderCart'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.cart</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 600<span class="token selector">;
  .curr</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token selector">;
    .icon-cart</span> <span class="token punctuation">{</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 22px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">em</span> <span class="token punctuation">{</span>
      <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 1px 6px<span class="token punctuation">;</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@helpColor</span><span class="token punctuation">;</span></span>
      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">&amp;:hover</span> <span class="token punctuation">{</span>
    <span class="token selector">.layer</span> <span class="token punctuation">{</span>
      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> none
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.layer</span> <span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> all .4s .2s<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-200px<span class="token punctuation">)</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 10px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">padding-top</span><span class="token punctuation">:</span> 10px<span class="token selector">;
    &amp;::before</span> <span class="token punctuation">{</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">right</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token property">top</span><span class="token punctuation">:</span> -10px<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.6<span class="token punctuation">,</span>1<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">box-shadow</span><span class="token punctuation">:</span> -3px -3px 5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.foot</span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 70px<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
      <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> #f8f8f8<span class="token punctuation">;</span>
      <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token selector">;
      .total</span> <span class="token punctuation">{</span>
        <span class="token property">padding-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token selector">;
        p</span> <span class="token punctuation">{</span>
          <span class="token selector">&amp;:last-child</span> <span class="token punctuation">{</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@priceColor</span><span class="token punctuation">;</span></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.list</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 310px<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0 10px<span class="token selector">;
    &amp;::-webkit-scrollbar</span><span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;::-webkit-scrollbar-track</span><span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> #f8f8f8<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;::-webkit-scrollbar-thumb</span><span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;::-webkit-scrollbar-thumb:hover</span><span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> #ccc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.item</span> <span class="token punctuation">{</span>
      <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #f5f5f5<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span>
      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token selector">;
      i</span> <span class="token punctuation">{</span>
          <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
          <span class="token property">bottom</span><span class="token punctuation">:</span> 38px<span class="token punctuation">;</span>
          <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
          <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>
          <span class="token property">transition</span><span class="token punctuation">:</span> all .5s<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">&amp;:hover</span> <span class="token punctuation">{</span>
        <span class="token selector">i</span> <span class="token punctuation">{</span>
          <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
          <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token selector">a</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token selector">;
        img</span> <span class="token punctuation">{</span>
          <span class="token property">height</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.center</span> <span class="token punctuation">{</span>
          <span class="token property">padding</span><span class="token punctuation">:</span> 0 10px<span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token selector">;
          .name</span> <span class="token punctuation">{</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token selector">.attr</span> <span class="token punctuation">{</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
            <span class="token property">padding-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.right</span> <span class="token punctuation">{</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
          <span class="token property">padding-right</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
          <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token selector">;
          .price</span> <span class="token punctuation">{</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@priceColor</span><span class="token punctuation">;</span></span>
          <span class="token punctuation">}</span>
          <span class="token selector">.count</span> <span class="token punctuation">{</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>使用getters得到有效商品列表和期种件数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 有效商品列表</span>
    <span class="token function">validList</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>stock <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>isEffective<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 有效商品件数</span>
    <span class="token function">validTotal</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> getters<span class="token punctuation">.</span>validList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p <span class="token operator">+</span> c<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 有效商品总金额</span>
    <span class="token function">validAmount</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> getters<span class="token punctuation">.</span>validList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p <span class="token operator">+</span> c<span class="token punctuation">.</span>nowPrice <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">*</span> c<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>渲染头部购物车信息</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>{{$store.getters['cart/validTotal']}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>layer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in $store.getters[<span class="token punctuation">'</span>cart/validList<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.skuId<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouterLink</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.picture<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name ellipsis-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr ellipsis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.attrsText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>price<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>{{item.nowPrice}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>x{{item.count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RouterLink</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-close-new<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foot<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>共 {{$store.getters['cart/validTotal']}} 件商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>{{$store.getters['cart/validAmount']}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>plain<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去购物车结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_04-头部购物车-商品列表-本地"><a href="#_04-头部购物车-商品列表-本地" class="header-anchor">#</a> 04-头部购物车-商品列表-本地</h2> <blockquote><p>目的：根据本地存储的商品获取最新的库存价格和有效状态。</p></blockquote> <p>大致步骤：</p> <ul><li>定义获取最新信息的API</li> <li>定义修改购物车商品信息的mutations</li> <li>定义获取购物车列表信息的actions</li> <li>在头部购物车组件初始化的时候更新列表信息</li></ul> <p>落的代码：</p> <ul><li>定义获取最新信息的API <code>src/api/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>

<span class="token comment">/**
 * 获取新的商品信息
 * @param {String} skuId - 商品SKUID
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getNewCartGoods</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/goods/stock/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skuId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>定义修改购物车商品信息的mutations   <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>     <span class="token comment">// 修改购物车商品</span>
    <span class="token function">updateCart</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> goods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// goods中字段有可能不完整，goods有的信息才去修改。</span>
      <span class="token comment">// 1. goods中必需又skuId，才能找到对应的商品信息</span>
      <span class="token keyword">const</span> updateGoods <span class="token operator">=</span> state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>skuId <span class="token operator">===</span> goods<span class="token punctuation">.</span>skuId<span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> goods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>goods<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> goods<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> goods<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          updateGoods<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> goods<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>定义获取购物车列表信息的actions <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 获取购物车列表</span>
    <span class="token function">findCartList</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录 TODO</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 本地</span>
          <span class="token comment">// Promise.all() 可以并列发送多个请求，等所有请求成功，调用then</span>
          <span class="token comment">// Promise.race() 可以并列发送多个请求，等最快的请求成功，调用then</span>
          <span class="token comment">// 传参事promise数组</span>
          <span class="token keyword">const</span> promiseArr <span class="token operator">=</span> ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 返回接口函数的调用</span>
            <span class="token keyword">return</span> <span class="token function">getNewCartGoods</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>skuId<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">dataArr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            dataArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateCart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skuId<span class="token operator">:</span> ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>skuId<span class="token punctuation">,</span> <span class="token operator">...</span>data<span class="token punctuation">.</span>result <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>再头部购物车组件初始化的时候更新列表信息 <code>src/components/app-header-cart.vue</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/findCartList'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="_05-头部购物车-删除操作-本地"><a href="#_05-头部购物车-删除操作-本地" class="header-anchor">#</a> 05-头部购物车-删除操作-本地</h2> <blockquote><p>目的：完成头部购物车删除操作，支持未登录状态。</p></blockquote> <p>大致步骤：</p> <ul><li>编写mutaions删除购物车商品逻辑</li> <li>编写actions进行删除操作</li> <li>在头部购物车进行删除逻辑</li></ul> <p>落的代码：</p> <ul><li>vuex的mutations和actions代码 <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... 省略</span>
    <span class="token comment">// 删除购物车商品</span>
    <span class="token function">deleteCart</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> skuId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>skuId <span class="token operator">===</span> skuId<span class="token punctuation">)</span>
      state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... 省略</span>
    <span class="token comment">// 删除购物车商品</span>
    <span class="token function">deleteCart</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> skuId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录 TODO</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 本地</span>
          ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'deleteCart'</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>头部组件实现删除逻辑 <code>src/components/app-header-cart.vue</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 购物车无商品不显示弹出层,并且不是在购物车页面
</span><span class="token prefix inserted">+</span><span class="token line">&lt;div class=&quot;layer&quot; v-if=&quot;$store.getters['cart/validTotal']&amp;&amp;$route.path!=='/cart'&quot;&gt;
</span></span></code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 绑定点击事件传入skuId
</span><span class="token prefix inserted">+</span><span class="token line">&lt;i @click=&quot;deleteCart(item.skuId)&quot; class=&quot;iconfont icon-close-new&quot;&gt;&lt;/i&gt;
</span></span></code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除</span>
    <span class="token keyword">const</span> <span class="token function-variable function">deleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/deleteCart'</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'删除成功'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'删除失败'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> deleteCart <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="_06-购物车页面-基础布局"><a href="#_06-购物车页面-基础布局" class="header-anchor">#</a> 06-购物车页面-基础布局</h2> <blockquote><p>目的：完成购物车组件基础布局和路由配置与跳转链接。</p></blockquote> <p><img src="/erabbit-client-pc-document/assets/img/1614736760455.7a380589.png" alt="1614736760455"></p> <p>大致步骤：</p> <ul><li>完成头部组件，购物车图标，购物车结算按钮，点击跳转购物车路由。商品点击跳转详情的操作。</li> <li>配置购物车路由和组件，完成基础布局。</li></ul> <p>落的代码：</p> <ul><li>跳转功能  <code>src/components/app-header-cart.vue</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &lt;RouterLink to=&quot;/cart&quot; class=&quot;curr&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      &lt;i class=&quot;iconfont icon-cart&quot;&gt;&lt;/i&gt;&lt;em&gt;{{$store.getters['cart/validTotal']}}&lt;/em&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &lt;/RouterLink&gt;
</span></span></code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       &lt;div class=&quot;item&quot; v-for=&quot;item in $store.getters['cart/validList']&quot; :key=&quot;item.skuId&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          &lt;RouterLink :to=&quot;`/product/${item.id}`&quot;&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           &lt;img :src=&quot;item.picture&quot; alt=&quot;&quot;&gt;
</span></span></code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>plain<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$router.push(<span class="token punctuation">'</span>/cart<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去购物车结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>组件与路由 <code>src/views/cart/index.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xtx-cart-page<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxBread</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxBreadItem</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxBreadItem</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxBreadItem</span><span class="token punctuation">&gt;</span></span>购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxBreadItem</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxBread</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxCheckbox</span><span class="token punctuation">&gt;</span></span>全选<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxCheckbox</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>商品信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>220<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>单价<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>180<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>数量<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>180<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>小计<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>140<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 有效商品 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i in 3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxCheckbox</span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouterLink</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://yanxuan-item.nosdn.127.net/13ab302f8f2c954d873f03be36f8fb03.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RouterLink</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name ellipsis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>和手足干裂说拜拜 ingrams手足皲裂修复霜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!-- 选择规格组件 --&gt;</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>200.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>比加入时降价 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>red<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>20.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxNumbox</span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>f16 red<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>200.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>移入收藏夹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>green<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>找相似<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 无效商品 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>失效商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i in 3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxCheckbox</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">color</span><span class="token punctuation">:</span>#eee<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouterLink</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://yanxuan-item.nosdn.127.net/13ab302f8f2c954d873f03be36f8fb03.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RouterLink</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name ellipsis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>和手足干裂说拜拜 ingrams手足皲裂修复霜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>颜色：粉色 尺寸：14cm 产地：中国<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>200.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;yen;">&amp;yen;</span>200.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>green<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>找相似<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 操作栏 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>batch<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxCheckbox</span><span class="token punctuation">&gt;</span></span>全选<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxCheckbox</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>移入收藏夹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>清空失效商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          共 7 件商品，已选择 2 件，商品合计：
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>red<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>¥400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>下单结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 猜你喜欢 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GoodRelevant</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> GoodRelevant <span class="token keyword">from</span> <span class="token string">'@/views/goods/components/goods-relevant'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'XtxCartPage'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> GoodRelevant <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.tc</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token selector">;
  .xtx-numbox</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 120px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.red</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@priceColor</span><span class="token punctuation">;</span></span>
<span class="token punctuation">}</span>
<span class="token selector">.green</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@xtxColor</span>
<span class="token punctuation">}</span>
.f16</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.goods</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token selector">;
  img</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">&gt; div</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 280px<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
    <span class="token property">padding-left</span><span class="token punctuation">:</span> 10px<span class="token selector">;
    .attr</span> <span class="token punctuation">{</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.action</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0 30px<span class="token selector">;
  .xtx-checkbox</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.batch</span> <span class="token punctuation">{</span>
    <span class="token selector">a</span> <span class="token punctuation">{</span>
      <span class="token property">margin-left</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.red</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.tit</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.xtx-cart-page</span> <span class="token punctuation">{</span>
  <span class="token selector">.cart</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token selector">;
    table</span> <span class="token punctuation">{</span>
      <span class="token property">border-spacing</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">border-collapse</span><span class="token punctuation">:</span> collapse<span class="token punctuation">;</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 24px<span class="token selector">;
      th,td</span><span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
        <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #f5f5f5<span class="token selector">;
        &amp;:first-child</span> <span class="token punctuation">{</span>
          <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
          <span class="token property">padding-left</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token selector">th</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
        <span class="token property">font-weight</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_07-购物车页面-列表展示-本地"><a href="#_07-购物车页面-列表展示-本地" class="header-anchor">#</a> 07-购物车页面-列表展示-本地</h2> <blockquote><p>目的：实现本地状态下的，购物车商品列表展示功能。</p></blockquote> <p>大致步骤：</p> <ul><li>准备失效商品列表数据。已选择商品列表数据。已选择商品件数数据。需要支付的金额数据。</li> <li>渲染模版</li></ul> <p>落的代码：</p> <ul><li>准备数据 <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// ... getters 代码</span>
    <span class="token comment">// 无效商品列表</span>
    <span class="token function">invalidList</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>stock <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>isEffective<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 选中商品列表</span>
    <span class="token function">selectedList</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> getters<span class="token punctuation">.</span>validList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>selected<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 选中商品件数</span>
    <span class="token function">selectedTotal</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> getters<span class="token punctuation">.</span>selectedList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p <span class="token operator">+</span> c<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 选中商品总金额</span>
    <span class="token function">selectedAmount</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> getters<span class="token punctuation">.</span>selectedList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p <span class="token operator">+</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>nowPrice <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">*</span> c<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否全选</span>
    <span class="token function">isCheckAll</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> getters<span class="token punctuation">.</span>validList<span class="token punctuation">.</span>length <span class="token operator">===</span> getters<span class="token punctuation">.</span>selectedList<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> getters<span class="token punctuation">.</span>selectedList<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>渲染列表</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     &lt;div class=&quot;cart&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;table&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;thead&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">           &lt;tr&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">              &lt;th width=&quot;120&quot;&gt;&lt;XtxCheckbox :modelValue=&quot;$store.getters['cart/isCheckAll']&quot;&gt;全选&lt;/XtxCheckbox&gt;&lt;/th&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">             &lt;th width=&quot;400&quot;&gt;商品信息&lt;/th&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;th width=&quot;220&quot;&gt;单价&lt;/th&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;th width=&quot;180&quot;&gt;数量&lt;/th&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;th width=&quot;180&quot;&gt;小计&lt;/th&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;th width=&quot;140&quot;&gt;操作&lt;/th&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">           &lt;/tr&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;/thead&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;!-- 有效商品 --&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;tbody&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">            &lt;tr v-for=&quot;item in $store.getters['cart/validList']&quot; :key=&quot;item.skuId&quot;&gt;
</span><span class="token prefix inserted">+</span><span class="token line">              &lt;td&gt;&lt;XtxCheckbox :modelValue=&quot;item.selected&quot; /&gt;&lt;/td&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">             &lt;td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;div class=&quot;goods&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                  &lt;RouterLink :to=&quot;`/product/${item.id}`&quot;&gt;
</span><span class="token prefix inserted">+</span><span class="token line">                    &lt;img :src=&quot;item.picture&quot; alt=&quot;&quot;&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 &lt;/RouterLink&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                 &lt;div&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                    &lt;p class=&quot;name ellipsis&quot;&gt;{{item.name}}&lt;/p&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                   &lt;!-- 选择规格组件 --&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                    &lt;p class=&quot;attr&quot;&gt;{{item.attrsText}}&lt;/p&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                &lt;p&gt;&amp;yen;{{item.nowPrice}}&lt;/p&gt;
</span><span class="token prefix inserted">+</span><span class="token line">                &lt;p v-if=&quot;item.price-item.nowPrice&gt;0&quot;&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 比加入时降价
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                  &lt;span class=&quot;red&quot;&gt;&amp;yen;{{item.price-item.nowPrice}}&lt;/span&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               &lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                &lt;XtxNumbox :modelValue=&quot;item.count&quot; /&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">             &lt;/td&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">              &lt;td class=&quot;tc&quot;&gt;&lt;p class=&quot;f16 red&quot;&gt;&amp;yen;{{item.nowPrice*100*item.count/100}}&lt;/p&gt;&lt;/td&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;p&gt;&lt;a href=&quot;javascript:;&quot;&gt;移入收藏夹&lt;/a&gt;&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;p&gt;&lt;a class=&quot;green&quot; href=&quot;javascript:;&quot;&gt;删除&lt;/a&gt;&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;p&gt;&lt;a href=&quot;javascript:;&quot;&gt;找相似&lt;/a&gt;&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">           &lt;/tr&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;/tbody&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;!-- 无效商品 --&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;tbody v-if=&quot;$store.getters['cart/invalidList'].length&gt;0&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">           &lt;tr&gt;&lt;td colspan=&quot;6&quot;&gt;&lt;h3 class=&quot;tit&quot;&gt;失效商品&lt;/h3&gt;&lt;/td&gt;&lt;/tr&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">           &lt;tr v-for=&quot;item in $store.getters['cart/validList']&quot; :key=&quot;item.skuId&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td&gt;&lt;XtxCheckbox style=&quot;color:#eee;&quot; /&gt;&lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;div class=&quot;goods&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                 &lt;RouterLink :to=&quot;`/product/${item.id}`&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;img :src=&quot;item.picture&quot; alt=&quot;&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                 &lt;/RouterLink&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                 &lt;div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;p class=&quot;name ellipsis&quot;&gt;{{item.name}}&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;p class=&quot;attr&quot;&gt;{{item.attrsText}}&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                 &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;&lt;p&gt;&amp;yen;{{item.nowPrice}}&lt;/p&gt;&lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;{{item.count}}&lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;&lt;p&gt;&amp;yen;{{item.nowPrice*100*item.count/100}}&lt;/p&gt;&lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;td class=&quot;tc&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;p&gt;&lt;a class=&quot;green&quot; href=&quot;javascript:;&quot;&gt;删除&lt;/a&gt;&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;p&gt;&lt;a href=&quot;javascript:;&quot;&gt;找相似&lt;/a&gt;&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">             &lt;/td&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">           &lt;/tr&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;/tbody&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;/table&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;!-- 操作栏 --&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;div class=&quot;action&quot;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;div class=&quot;batch&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          &lt;XtxCheckbox :modelValue=&quot;$store.getters['cart/isCheckAll']&quot;&gt;全选&lt;/XtxCheckbox&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">         &lt;a href=&quot;javascript:;&quot;&gt;删除商品&lt;/a&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;a href=&quot;javascript:;&quot;&gt;移入收藏夹&lt;/a&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">         &lt;a href=&quot;javascript:;&quot;&gt;清空失效商品&lt;/a&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;div class=&quot;total&quot;&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          共 {{$store.getters['cart/validTotal']}} 件商品，已选择 {{$store.getters['cart/selectedTotal']}} 件，商品合计：
</span><span class="token prefix inserted">+</span><span class="token line">          &lt;span class=&quot;red&quot;&gt;¥{{$store.getters['cart/selectedAmount']}}&lt;/span&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">         &lt;XtxButton type=&quot;primary&quot;&gt;下单结算&lt;/XtxButton&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">       &lt;/div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;/div&gt;
</span></span></code></pre></div><h2 id="_08-购物车页面-单选操作-本地"><a href="#_08-购物车页面-单选操作-本地" class="header-anchor">#</a> 08-购物车页面-单选操作-本地</h2> <blockquote><p>目的：实现本地状态下的，选中商品操作。</p></blockquote> <p>大致步骤：</p> <ul><li>使用购物车商品修改信息的mutations（已实现）</li> <li>定义购物车商品选中状态的actions</li> <li>在购物车页面绑定单选的复选框change事件</li> <li>在事件中调用actions的修改函数</li></ul> <p>落的代码：</p> <ul><li>定义修改购物车商品选中状态的mutations <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 修改购物车商品
</span><span class="token prefix unchanged"> </span><span class="token line">   updateCart (state, goods) {
</span><span class="token prefix unchanged"> </span><span class="token line">     // goods中字段有可能不完整，goods有的信息才去修改。
</span><span class="token prefix unchanged"> </span><span class="token line">     // 1. goods中必需又skuId，才能找到对应的商品信息
</span><span class="token prefix unchanged"> </span><span class="token line">     const updateGoods = state.list.find(item =&gt; item.skuId === goods.skuId)
</span><span class="token prefix unchanged"> </span><span class="token line">     for (const key in goods) {
</span><span class="token prefix unchanged"> </span><span class="token line">       // 布尔类型 false 值需要使用
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       if (goods[key] !== null &amp;&amp; goods[key] !== undefined &amp;&amp; goods[key] !== '') {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">         updateGoods[key] = goods[key]
</span><span class="token prefix unchanged"> </span><span class="token line">       }
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span></code></pre></div><ul><li>定义修改购物车商品的actions <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 修改购物车商品</span>
    <span class="token function">updateCart</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> goods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// goods 中：必须有skuId，其他想修改的属性 selected  count</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录 TODO</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 本地</span>
          ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateCart'</span><span class="token punctuation">,</span> goods<span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>在购物车页面绑定单选的复选框change事件并处理选中  <code>src/views/cart/index.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxCheckbox</span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$event=&gt;checkOne(item.skuId,$event)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:modelValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.selected<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> GoodRelevant <span class="token keyword">from</span> <span class="token string">'@/views/goods/components/goods-relevant'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'XtxCartPage'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> GoodRelevant <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 单选</span>
    <span class="token keyword">const</span> <span class="token function-variable function">checkOne</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId<span class="token punctuation">,</span> selected</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/updateCart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> selected <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_09-购物车页面-全选操作-本地"><a href="#_09-购物车页面-全选操作-本地" class="header-anchor">#</a> 09-购物车页面-全选操作-本地</h2> <blockquote><p>目的：实现本地状态下的，全选商品操作。</p></blockquote> <p>大致步骤：</p> <ul><li>修改购物车所有有效商品选中状态的actions</li> <li>在购物车页面修改调用actions的代码</li> <li>在购物车页面绑定全选的复选框change事件</li> <li>在事件中调用actions的修改函数</li></ul> <p>落的代码</p> <ul><li>修改购物车商品选中状态的actions让其支持全选 <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 做有效商品的全选&amp;反选</span>
    <span class="token function">checkAllCart</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> selected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录 TODO</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 本地</span>
          <span class="token comment">// 1. 获取有效的商品列表，遍历的去调用修改mutations即可</span>
          ctx<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>validList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateCart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skuId<span class="token operator">:</span> item<span class="token punctuation">.</span>skuId<span class="token punctuation">,</span> selected <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>在购物车页面修改调用actions的代码   <code>src/views/cart/index.vue</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 全选</span>
    <span class="token keyword">const</span> <span class="token function-variable function">checkAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selected</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/checkAllCart'</span><span class="token punctuation">,</span> selected<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll <span class="token punctuation">}</span>
</code></pre></div><ul><li>在购物车页面绑定全选的复选框change事件并处理选中  <code>src/views/cart/index.vue</code></li></ul> <div class="language-VUE extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 两处都需要加 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxCheckbox</span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:modelValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.getters[<span class="token punctuation">'</span>cart/isCheckAll<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>全选<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxCheckbox</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="_10-购物车页面-删除操作-本地"><a href="#_10-购物车页面-删除操作-本地" class="header-anchor">#</a> 10-购物车页面-删除操作-本地</h2> <blockquote><p>目的：实现本地状态下，购物车商品删除</p></blockquote> <p>大致步骤：</p> <ul><li>绑定<code>删除</code>点击事件指定处理函数，调用删除actions</li> <li>处理无商品展示界面</li></ul> <p>落的代码：</p> <ul><li>绑定<code>删除</code>点击事件指定处理函数，调用删除actions      <code>src/views/cart/index.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 两处删除都绑定 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteCart(item.skuId)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>green<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 删除</span>
    <span class="token keyword">const</span> <span class="token function-variable function">deleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/deleteCart'</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll<span class="token punctuation">,</span> deleteCart <span class="token punctuation">}</span>
</code></pre></div><ul><li>处理无商品展示界面</li></ul> <p>组件 <code>src/views/cart/components/cart-none.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart-none<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@/assets/images/none.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>购物车内暂时没有商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$router.push(<span class="token punctuation">'</span>/<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>继续逛逛<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CartNone'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.cart-none</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 150px 0<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token selector">;
  img</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 180px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">p</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #999999<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 20px 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用 <code>src/views/cart/index.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import XtxConfirm from '@/components/library/xtx-confirm'
</span></span>import { useStore } from 'vuex'
export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> name: 'XtxCartPage',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  components: { GoodRelevant, CartNone },
</span></span></code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>          <span class="token comment">&lt;!-- 有效商品 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.getters[<span class="token punctuation">'</span>cart/validList<span class="token punctuation">'</span>].length===0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CartNone</span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_11-购物车页面-确认框组件"><a href="#_11-购物车页面-确认框组件" class="header-anchor">#</a> 11-购物车页面-确认框组件</h2> <blockquote><p>目的：通过vue实例调用$confirm函数弹出确认框。import导入函数使用也需要支持。</p></blockquote> <p><img src="/erabbit-client-pc-document/assets/img/1614930412684.ae937353.png" alt="1614930412684"></p> <p>大致步骤：</p> <ul><li>实现组件基础结构和样式。</li> <li>实现函数式调用组件方式和完成交互。</li> <li>加上打开时动画效果。</li> <li>给购物车删除加上确认框。</li> <li>给vue挂载原型函数$confirm。</li></ul> <p>落地代码：</p> <ul><li>实现组件基础结构和样式。</li></ul> <p>组件 <code>src/components/library/xtx-confirm.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xtx-confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>温馨提示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JavaScript:;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-close-new<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-warning<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>您确认从购物车删除该商品吗？<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gray<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'XtxConfirm'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.xtx-confirm</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 8888<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>.5<span class="token punctuation">)</span><span class="token selector">;
  .wrapper</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span>-50%<span class="token punctuation">)</span><span class="token selector">;
    .header,.footer</span> <span class="token punctuation">{</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 0 20px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.body</span> <span class="token punctuation">{</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 20px 40px<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token selector">;
      .icon-warning</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@priceColor</span><span class="token punctuation">;</span></span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.footer</span> <span class="token punctuation">{</span>
      <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token selector">;
      .xtx-button</span> <span class="token punctuation">{</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.header</span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token selector">;
      h3</span> <span class="token punctuation">{</span>
        <span class="token property">font-weight</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">a</span> <span class="token punctuation">{</span>
        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
        <span class="token property">right</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token selector">;
        &amp;:hover</span> <span class="token punctuation">{</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p style="color:red;">为了看到布局在购物车页面用下</p>
- 实现函数式调用组件方式和完成交互。
<p><img src="/erabbit-client-pc-document/assets/img/1614911568181.1a3735c5.png" alt="1614911568181"></p> <p>定义函数  <code>src/components/library/confirm.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createVNode<span class="token punctuation">,</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> XtxConfirm <span class="token keyword">from</span> <span class="token string">'./xtx-confirm'</span>

<span class="token comment">// 准备div</span>
<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'xtx-confirm-container'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>

<span class="token comment">// 该函数渲染XtxConfirm组件，标题和文本</span>
<span class="token comment">// 函数的返回值是promise对象</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> text <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">submitCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> div<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">cancelCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> div<span class="token punctuation">)</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'点击取消'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 1. 渲染组件</span>
    <span class="token comment">// 2. 点击确认按钮，触发resolve同时销毁组件</span>
    <span class="token comment">// 3. 点击取消按钮，触发reject同时销毁组件</span>
    <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>XtxConfirm<span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> text<span class="token punctuation">,</span> submitCallback<span class="token punctuation">,</span> cancelCallback <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> div<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>组件逻辑 <code>src/components/library/xtx-confirm.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xtx-confirm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{fade}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{fade}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancelCallback()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JavaScript:;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-close-new<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-warning<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{text}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancelCallback()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gray<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submitCallback()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 当前组件不是在APP下进行渲染，无法使用APP下的环境（全局组件，全局指令，原型属性函数）</span>
<span class="token keyword">import</span> XtxButton <span class="token keyword">from</span> <span class="token string">'@/components/library/xtx-button'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'XtxConfirm'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> XtxButton <span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'温馨提示'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    submitCallback<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Function
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cancelCallback<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Function
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fade <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当元素渲染完毕立即过渡的动画不会触发</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        fade<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> fade <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.xtx-confirm</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 8888<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token selector">;
  &amp;.fade</span> <span class="token punctuation">{</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> all 0.4s<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>.5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.wrapper</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span>-60%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token selector">;
    &amp;.fade</span> <span class="token punctuation">{</span>
      <span class="token property">transition</span><span class="token punctuation">:</span> all 0.4s<span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.header,.footer</span> <span class="token punctuation">{</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 0 20px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.body</span> <span class="token punctuation">{</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 20px 40px<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token selector">;
      .icon-warning</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@priceColor</span><span class="token punctuation">;</span></span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.footer</span> <span class="token punctuation">{</span>
      <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token selector">;
      .xtx-button</span> <span class="token punctuation">{</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.header</span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token selector">;
      h3</span> <span class="token punctuation">{</span>
        <span class="token property">font-weight</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">a</span> <span class="token punctuation">{</span>
        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
        <span class="token property">right</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token selector">;
        &amp;:hover</span> <span class="token punctuation">{</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用函数 <code>src/views/cart/index.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 删除</span>
    <span class="token keyword">const</span> <span class="token function-variable function">deleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// store.dispatch('cart/deleteCart', skuId)</span>
      <span class="token function">Confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'您确定从购物车删除该商品吗？'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击确认'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击取消'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll<span class="token punctuation">,</span> deleteCart <span class="token punctuation">}</span>
</code></pre></div><ul><li>加上打开时动画效果。  <code>src/components/library/xtx-confirm.vue</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>.xtx-confirm {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> position: fixed;
</span><span class="token prefix unchanged"> </span><span class="token line"> left: 0;
</span><span class="token prefix unchanged"> </span><span class="token line"> top: 0;
</span><span class="token prefix unchanged"> </span><span class="token line"> width: 100%;
</span><span class="token prefix unchanged"> </span><span class="token line"> height: 100%;
</span><span class="token prefix unchanged"> </span><span class="token line"> z-index: 8888;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  background: rgba(0,0,0,0);
</span><span class="token prefix inserted">+</span><span class="token line">  &amp;.fade {
</span><span class="token prefix inserted">+</span><span class="token line">    transition: all 0.4s;
</span><span class="token prefix inserted">+</span><span class="token line">    background: rgba(0,0,0,.5);
</span><span class="token prefix inserted">+</span><span class="token line">  }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> .wrapper {
</span><span class="token prefix unchanged"> </span><span class="token line">   width: 400px;
</span><span class="token prefix unchanged"> </span><span class="token line">   background: #fff;
</span><span class="token prefix unchanged"> </span><span class="token line">   border-radius: 4px;
</span><span class="token prefix unchanged"> </span><span class="token line">   position: absolute;
</span><span class="token prefix unchanged"> </span><span class="token line">   top: 50%;
</span><span class="token prefix unchanged"> </span><span class="token line">   left: 50%;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    transform: translate(-50%,-60%);
</span><span class="token prefix inserted">+</span><span class="token line">    opacity: 0;
</span><span class="token prefix inserted">+</span><span class="token line">    &amp;.fade {
</span><span class="token prefix inserted">+</span><span class="token line">      transition: all 0.4s;
</span><span class="token prefix inserted">+</span><span class="token line">      transform: translate(-50%,-50%);
</span><span class="token prefix inserted">+</span><span class="token line">      opacity: 1;
</span><span class="token prefix inserted">+</span><span class="token line">    }
</span></span></code></pre></div><p>给购物车删除加上确认框   <code>src/views/cart/index.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> <span class="token function-variable function">deleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">Confirm</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">' 您确认从购物车删除该商品吗？'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log('点击确认')</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/deleteCart'</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>skuId<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log('点击取消')</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>给vue挂载原型函数</li></ul> <p>实现：<code>src/components/library/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Confirm <span class="token keyword">from</span> <span class="token string">'./Confirm'</span>
</code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 如果你想挂载全局的属性，能够通过组件实例调用的属性   this.$message
</span><span class="token prefix unchanged"> </span><span class="token line">   app.config.globalProperties.$message = Message
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    app.config.globalProperties.$confirm = Confirm
</span></span></code></pre></div><p>测试：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_12-购物车页面-批量删除-本地"><a href="#_12-购物车页面-批量删除-本地" class="header-anchor">#</a> 12-购物车页面-批量删除-本地</h2> <blockquote><p>目的：实现本地批量删除选中商品功能。</p></blockquote> <p>大致的步骤：</p> <ul><li>定义一个批量删除商品的actions支持批量操作</li> <li>遍历选中商品，调用单个删除调用mutations函数即可</li> <li>绑定批量删除点击事件指定处理函数，调用actions进行删除。</li></ul> <p>落地代码：</p> <ul><li>批量操作商品的actions支持 <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 批量删除选中商品</span>
    <span class="token function">batchDeleteCart</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录 TODO</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 本地</span>
          <span class="token comment">// 1. 获取选中商品列表，进行遍历调用deleteCart mutataions函数</span>
          ctx<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>selectedList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'deleteCart'</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>skuId<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>绑定批量删除点击事件指定处理函数，调用actions进行删除。  <code>src/views/cart/index.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>batchDeleteCart()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 批量删除</span>
    <span class="token keyword">const</span> <span class="token function-variable function">batchDeleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">Confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'您确定从购物车删除选中的商品吗？'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/batchDeleteCart'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll<span class="token punctuation">,</span> deleteCart<span class="token punctuation">,</span> batchDeleteCart <span class="token punctuation">}</span>
</code></pre></div><h2 id="_13-购物车页面-无效商品-本地"><a href="#_13-购物车页面-无效商品-本地" class="header-anchor">#</a> 13-购物车页面-无效商品-本地</h2> <blockquote><p>目的：实现本地清空无效商品功能。</p></blockquote> <p>大致思路：</p> <ul><li>去修改批量删除的actions让它适用于两个场景
<ul><li>批量删除选中的</li> <li>批量删除失效的  isClear</li></ul></li></ul> <p>落地代码：</p> <ul><li>绑定清空无效商品点击事件指定处理函数，调用actions进行删除。  <code>src/views/cart/index.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>batchDeleteCart(true)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>清空失效商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 批量删除
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    const batchDeleteCart = (isClear) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">      Confirm({ text: `您确定从购物车删除${isClear ? '失效' : '选中'}的商品吗？` }).then(() =&gt; {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       store.dispatch('cart/batchDeleteCart', isClear)
</span><span class="token prefix unchanged"> </span><span class="token line">     }).catch(e =&gt; {})
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line">   return { checkOne, checkAll, deleteCart, batchDeleteSelectedCart, batchDeleteInvalidCart }
</span></span></code></pre></div><ul><li>批量删除商品的actions支持清空无效 <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 批量删除选中商品
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    batchDeleteCart (ctx, isClear) {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span><span class="token prefix unchanged"> </span><span class="token line">         // 登录 TODO
</span><span class="token prefix unchanged"> </span><span class="token line">       } else {
</span><span class="token prefix unchanged"> </span><span class="token line">         // 本地
</span><span class="token prefix unchanged"> </span><span class="token line">         // 1. 获取选中商品列表，进行遍历调用deleteCart mutataions函数
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          ctx.getters[isClear ? 'invalidList' : 'selectedList'].forEach(item =&gt; {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           ctx.commit('deleteCart', item.skuId)
</span><span class="token prefix unchanged"> </span><span class="token line">         })
</span><span class="token prefix unchanged"> </span><span class="token line">         resolve()
</span><span class="token prefix unchanged"> </span><span class="token line">       }
</span><span class="token prefix unchanged"> </span><span class="token line">     })
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span></code></pre></div><h2 id="_14-购物车页面-修改数量-本地"><a href="#_14-购物车页面-修改数量-本地" class="header-anchor">#</a> 14-购物车页面-修改数量-本地</h2> <blockquote><p>目的：实现本地版本的修改商品数量。</p></blockquote> <p>大致的步骤：</p> <ul><li>绑定xtx-numbox组件的change事件指定处理函数</li> <li>在函数种调用vuex的cart/updateCart函数修改数量</li></ul> <p>落的代码：</p> <ul><li>绑定xtx-numbox组件的change事件指定处理函数</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxNumbox</span> <span class="token attr-name">:max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.stock<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$event=&gt;changeCount(item.skuId,$event)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:modelValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.count<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>在函数种调用vuex的cart/updateCart函数修改数量</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 修改数量</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/updateCart'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll<span class="token punctuation">,</span> deleteCart<span class="token punctuation">,</span> batchDeleteCart<span class="token punctuation">,</span> changeCount <span class="token punctuation">}</span>
</code></pre></div><h2 id="_15-购物车页面-修改规格-本地"><a href="#_15-购物车页面-修改规格-本地" class="header-anchor">#</a> 15-购物车页面-修改规格-本地</h2> <blockquote><p>目的：封装一个购物车SKU组件，来修改规格。</p></blockquote> <p><img src="/erabbit-client-pc-document/assets/img/1614930433557.de391fff.png" alt="1614930433557"></p> <p>大致步骤：</p> <ul><li>定义一个组件完成基础结构</li> <li>完成展开收起操作</li> <li>展开的时候根据skuId得到商品信息（specs,skus）渲染商品规格。</li> <li>选择完毕后，点击确认后，修改当前商品规格。</li></ul> <p>落的代码：</p> <ul><li>1.定义一个组件完成基础结构</li></ul> <p>定义组件  <code>src/views/cart/components/cart-sku.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart-sku<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ellipsis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>颜色：粉色 尺寸：14cm 产地：中国<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-angle-down<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>layer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CartSku'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.cart-sku</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 28px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #f5f5f5<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0 6px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token selector">;
  .attrs</span> <span class="token punctuation">{</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token selector">;
    span</span> <span class="token punctuation">{</span>
      <span class="token property">max-width</span><span class="token punctuation">:</span> 230px<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">i</span> <span class="token punctuation">{</span>
      <span class="token property">margin-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.layer</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid <span class="token atrule"><span class="token rule">@xtxColor</span><span class="token punctuation">;</span></span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 2px 2px 4px <span class="token function">lighten</span><span class="token punctuation">(</span><span class="token atrule"><span class="token rule">@xtxColor</span><span class="token punctuation">,</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token selector">;
    &amp;::before</span> <span class="token punctuation">{</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token property">border-left</span><span class="token punctuation">:</span> 1px solid <span class="token atrule"><span class="token rule">@xtxColor</span><span class="token punctuation">;</span></span>
      <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid <span class="token atrule"><span class="token rule">@xtxColor</span><span class="token punctuation">;</span></span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">left</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token property">top</span><span class="token punctuation">:</span> -8px<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>.8<span class="token punctuation">,</span>1<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.loading</span> <span class="token punctuation">{</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 224px<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../../../assets/images/loading.gif<span class="token punctuation">)</span></span> no-repeat center<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用组件 <code>src/views/cart/index.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import CartSku from './components/cart-sku'
</span></span>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> name: 'XtxCartPage',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  components: { GoodRelevant, CartNone, CartSku },
</span></span></code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 &lt;div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;p class=&quot;name ellipsis&quot;&gt;{{item.name}}&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;!-- 选择规格组件 --&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                    &lt;CartSku /&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 &lt;/div&gt;
</span></span></code></pre></div><ul><li>2.完成展开收起操作  <code>src/views/cart/components/cart-sku.vue</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart-sku<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ellipsis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{attrsText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onClickOutside <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vueuse/core'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CartSku'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    attrsText<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> visible <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> goods <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      visible<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">hide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      visible<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      visible<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token function">onClickOutside</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> visible<span class="token punctuation">,</span> toggle<span class="token punctuation">,</span> target<span class="token punctuation">,</span> goods <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>3.展开的时候根据skuId得到商品信息（specs,skus）渲染商品规格。</li></ul> <p>接口API  <code>src/api/goods.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 获取商品的specs和skus
 * @param {String} skuId - 商品SKUID
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getSpecsAndSkus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skuId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/goods/sku/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skuId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>使用组件传人skuId  <code>src/views/cart/index.vue</code></p> <div class="language-DIFF extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 &lt;div&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;p class=&quot;name ellipsis&quot;&gt;{{item.name}}&lt;/p&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;!-- 选择规格组件 --&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">                    &lt;CartSku attrs-text=&quot;item.attrsText&quot; :skuId=&quot;item.skuId&quot; /&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                 &lt;/div&gt;
</span></span></code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">,</span>
    skuId<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>请求数据渲染  <code>src/views/cart/components/cart-sku.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>layer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visible<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!goods<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GoodsSku</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:skuId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skuId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:goods</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">margin-left</span><span class="token punctuation">:</span>60px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    const goods = ref(null)
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   const show = () =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">     visible.value = true
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      // 获取当前spec和sku数据
</span><span class="token prefix inserted">+</span><span class="token line">      getSpecsAndSkus(props.skuId).then(data =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">        goods.value = data.result
</span><span class="token prefix inserted">+</span><span class="token line">      })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line">   const hide = () =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">     visible.value = false
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      goods.value = null
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span></code></pre></div><ul><li>4.选择完毕后，点击确认后，修改当前商品规格。</li></ul> <p><img src="/erabbit-client-pc-document/assets/img/1617437118311.15493251.png" alt="1617437118311"></p> <p>cart-sku.vue组件确认后传出sku信息</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 选择SKU时候触发</span>
    <span class="token keyword">const</span> currSku <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeSku</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sku</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      currSku<span class="token punctuation">.</span>value <span class="token operator">=</span> sku
    <span class="token punctuation">}</span>
    <span class="token comment">// 点击确认的时候，提交sku信息给购物车组件</span>
    <span class="token keyword">const</span> <span class="token function-variable function">submit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 给购物车组件数据的前提：有sku信息，sku信息完整，sku中的skuId不能现有props.skuId一样</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currSku<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> currSku<span class="token punctuation">.</span>value<span class="token punctuation">.</span>skuId <span class="token operator">&amp;&amp;</span> currSku<span class="token punctuation">.</span>value<span class="token punctuation">.</span>skuId <span class="token operator">!==</span> props<span class="token punctuation">.</span>skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> currSku<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> visible<span class="token punctuation">,</span> toggle<span class="token punctuation">,</span> target<span class="token punctuation">,</span> goods<span class="token punctuation">,</span> changeSku<span class="token punctuation">,</span> submit <span class="token punctuation">}</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GoodsSku</span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeSku<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:skuId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skuId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:goods</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>cart/index.vue组件给cark-sku.vue组件绑定change事件，传入默认值和当前的商品信息。</p> <div class="language-vue extra-class"><pre class="language-vue"><code>                    <span class="token comment">&lt;!-- 选择规格组件 --&gt;</span>
&lt;CartSku @change=&quot;$event=&gt;updateCartSku(item.skuId,$event)&quot;
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>     <span class="token comment">// 修改规格</span>
    <span class="token keyword">const</span> <span class="token function-variable function">updateCartSku</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldSkuId<span class="token punctuation">,</span> newSku</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/updateCartSku'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> oldSkuId<span class="token punctuation">,</span> newSku <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll<span class="token punctuation">,</span> deleteCart<span class="token punctuation">,</span> batchDeleteCart<span class="token punctuation">,</span> changeCount<span class="token punctuation">,</span> updateCartSku <span class="token punctuation">}</span>

</code></pre></div><p>再在actions种实现逻辑  <code>src/store/modules/cart.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 修改sku规格函数</span>
    <span class="token function">updateCartSku</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span> oldSkuId<span class="token punctuation">,</span> newSku <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录 TODO</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 本地</span>
          <span class="token comment">// 但你修改了sku的时候其实skuId需要更改，相当于把原来的信息移出，创建一条新的商品信息。</span>
          <span class="token comment">// 1. 获取旧的商品信息</span>
          <span class="token keyword">const</span> oldGoods <span class="token operator">=</span> ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>skuId <span class="token operator">===</span> oldSkuId<span class="token punctuation">)</span>
          <span class="token comment">// 2. 删除旧的商品</span>
          ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'deleteCart'</span><span class="token punctuation">,</span> oldSkuId<span class="token punctuation">)</span>
          <span class="token comment">// 3. 合并一条新的商品信息</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> price<span class="token operator">:</span> nowPrice<span class="token punctuation">,</span> inventory<span class="token operator">:</span> stock<span class="token punctuation">,</span> specsText<span class="token operator">:</span> attrsText <span class="token punctuation">}</span> <span class="token operator">=</span> newSku
          <span class="token keyword">const</span> newGoods <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>oldGoods<span class="token punctuation">,</span> skuId<span class="token punctuation">,</span> nowPrice<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> attrsText <span class="token punctuation">}</span>
          <span class="token comment">// 4. 去插入即可</span>
          ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'insertCart'</span><span class="token punctuation">,</span> newGoods<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_16-登录后-合并购物车"><a href="#_16-登录后-合并购物车" class="header-anchor">#</a> 16-登录后-合并购物车</h2> <blockquote><p>目的：登录后需要把把本地购物车合并，且清空本地购物车。</p></blockquote> <p><img src="/erabbit-client-pc-document/assets/img/1615173625779.da59926b.png" alt="1615173625779"></p> <p>大致步骤：</p> <ul><li>编写合并购物车的API接口函数</li> <li>编写设置购物车数据的mutations目的是清空购物车</li> <li>编写合并购物车的actions函数，实现合并后清空本地</li> <li>在登录完成后调用合并购物车函数</li></ul> <p>落地代码：</p> <ul><li>编写合并购物车的API接口函数 <code>src/api/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 合并本地购物车
 * @param {Array&lt;object&gt;} cartList - 本地购物车数组
 * @param {String} item.skuId - 商品SKUID
 * @param {Boolean} item.selected - 是否选中
 * @param {Integer} item.count - 数量
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">mergeLocalCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cartList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/member/cart/merge'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">,</span> cartList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>编写设置购物车数据的mutations目的是清空购物车  <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 设置购物车列表</span>
    <span class="token function">setCartList</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>list <span class="token operator">=</span> list
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>编写合并购物车的actions函数，实现合并后清空本地  <code>src/store/module/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 购物车状态</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeCart <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/cart'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 合并本地购物车</span>
    <span class="token keyword">async</span> <span class="token function">mergeLocalCart</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 存储token后调用合并API接口函数进行购物合并</span>
      <span class="token keyword">const</span> cartList <span class="token operator">=</span> ctx<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>validList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> selected<span class="token punctuation">,</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> selected<span class="token punctuation">,</span> count <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token function">mergeLocalCart</span><span class="token punctuation">(</span>cartList<span class="token punctuation">)</span>
      <span class="token comment">// 合并成功将本地购物车删除</span>
      ctx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setCartList'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>在登录完成（绑定成功，完善信息成功）后调用合并购物车函数</li></ul> <p><code>login/components/login-form.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token comment">// 合并购物车操作</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/mergeLocalCart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 2. 提示</span>
          <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'登录成功'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">// 3. 跳转</span>
          router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirectUrl <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>login/components/login-bind.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>          <span class="token comment">// 合并购物车操作</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/mergeLocalCart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 2. 提示</span>
            <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'绑定成功'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 3. 跳转</span>
            router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>redirectUrl <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>login/components/login-path.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>          <span class="token comment">// 合并购物车操作</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/mergeLocalCart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 2. 提示</span>
            <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'完善信息成功'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 3. 跳转</span>
            router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>redirectUrl <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>login/callback.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cart/mergeLocalCart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 2. 跳转到来源页或者首页</span>
            router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>redirectUrl<span class="token punctuation">)</span>
            <span class="token comment">// 3. 成功提示</span>
            <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'QQ登录成功'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_17-登录后-商品列表"><a href="#_17-登录后-商品列表" class="header-anchor">#</a> 17-登录后-商品列表</h2> <blockquote><p>目标：实现登陆后获取购物车商品列表。</p></blockquote> <p>大致步骤：</p> <ul><li>编写获取商品列表的API接口函数</li> <li>在actions原有预留TODO位置获取列表</li> <li>退出登录需要清空购物车</li></ul> <p>落地代码：</p> <ul><li>编写获取商品列表的API接口函数  <code>src/api/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 获取登录后的购物车列表
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">findCartList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/member/cart'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在actions原有预留TODO位置获取列表   <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 获取购物车列表
</span><span class="token prefix unchanged"> </span><span class="token line">   findCartList (ctx) {
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">          findCartList().then(data =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">            resolve()
</span><span class="token prefix inserted">+</span><span class="token line">          })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       }
</span></span></code></pre></div><ul><li>退出登录需要清空购物车 <code>src/components/app-navbar.vue</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 退出登录
</span><span class="token prefix unchanged"> </span><span class="token line">   // 1. 清空本地存储信息和vuex的用户信息
</span><span class="token prefix unchanged"> </span><span class="token line">   // 2. 跳转登录
</span><span class="token prefix unchanged"> </span><span class="token line">   const router = useRouter()
</span><span class="token prefix unchanged"> </span><span class="token line">   const logout = () =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">     store.commit('user/setUser', {})
</span><span class="token prefix unchanged"> </span><span class="token line">     // 清空购物车
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      store.commit('cart/setCartList', [])
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     router.push('/login')
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span></code></pre></div><h2 id="_18-登录后-加入购物车"><a href="#_18-登录后-加入购物车" class="header-anchor">#</a> 18-登录后-加入购物车</h2> <blockquote><p>目标：实现登陆后加入购物车。</p></blockquote> <p>大致步骤：</p> <ul><li>编写加入购物车的API接口函数</li> <li>在actions原有预留TODO位置加入购物车</li></ul> <p>落地代码：</p> <ul><li>编写加入购物车的API接口函数 <code>src/api/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 加入购物车
 * @param {String} skuId - 商品SKUID
 * @param {Integer} count - 商品数量
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">insertCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/member/cart'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skuId<span class="token punctuation">,</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在actions原有预留TODO位置加入购物车  <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 加入购物车
</span><span class="token prefix unchanged"> </span><span class="token line">   insertCart (ctx, goods) {
</span><span class="token prefix unchanged"> </span><span class="token line">     // ctx.state 当前模块状态 ctx.rootState 根状态对象
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">          insertCart(goods).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            return findCartList()
</span><span class="token prefix inserted">+</span><span class="token line">          }).then((data) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">            resolve()
</span><span class="token prefix inserted">+</span><span class="token line">          })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       }
</span></span></code></pre></div><h2 id="_19-登录后-删除操作"><a href="#_19-登录后-删除操作" class="header-anchor">#</a> 19-登录后-删除操作</h2> <blockquote><p>目标：实现登陆后删除购物车商品操作（批量删除，清空无效）</p></blockquote> <p>大致步骤：</p> <ul><li>编写删除购物车商品的API接口函数</li> <li>在actions原有预留TODO位置删除购物车商品</li></ul> <p>落地代码：</p> <ul><li>编写删除购物车商品的API接口函数 <code>src/api/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 删除商品（支持批量删除）
 * @param {Array&lt;string&gt;} ids - skuId集合
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">deleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ids</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/member/cart'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>ids<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>在actions原有预留TODO位置删除购物车商品   <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 删除购物车商品
</span><span class="token prefix unchanged"> </span><span class="token line">   deleteCart (ctx, skuId) {
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">         // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">         deleteCart([skuId]).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">           return findCartList()
</span><span class="token prefix inserted">+</span><span class="token line">         }).then((data) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">           ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">           resolve()
</span><span class="token prefix inserted">+</span><span class="token line">         })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       }
</span></span></code></pre></div><h2 id="_20-登录后-批量删除"><a href="#_20-登录后-批量删除" class="header-anchor">#</a> 20-登录后-批量删除</h2> <blockquote><p>目标：完成批量删除选中商品，完成清空失效的商品</p></blockquote> <p>大概步骤：</p> <ul><li>完成cart.js模块中的批量删除actions的登录状态下逻辑</li></ul> <p>落的代码：</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 批量删除选中商品
</span><span class="token prefix unchanged"> </span><span class="token line">   batchDeleteCart (ctx, isClear) {
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">          // 得到需要删除的商品列表（失效，选中）的skuId集合
</span><span class="token prefix inserted">+</span><span class="token line">          const ids = ctx.getters[isClear ? 'invalidList' : 'selectedList'].map(item =&gt; item.skuId)
</span><span class="token prefix inserted">+</span><span class="token line">          deleteCart(ids).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            return findCartList()
</span><span class="token prefix inserted">+</span><span class="token line">          }).then((data) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">            resolve()
</span><span class="token prefix inserted">+</span><span class="token line">          })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       } else {
</span></span></code></pre></div><p>注意：<code>views/cart/index.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 批量删除</span>
    <span class="token keyword">const</span> <span class="token function-variable function">batchDeleteCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">isClear</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果要做批量删除的列表无数据，阻止提示下没有你要删除的商品。</span>
      <span class="token comment">// 清空失效商品：目前传人[]数据，会清空说有的商品包括有效商品（后台BUG）</span>
</code></pre></div><h2 id="_21-登录后-选中状态-修改数量"><a href="#_21-登录后-选中状态-修改数量" class="header-anchor">#</a> 21-登录后-选中状态&amp;修改数量</h2> <blockquote><p>目的：实现登录后的选中操作。</p></blockquote> <p>大致步骤：</p> <ul><li>编写修改购物车商品的API接口函数</li> <li>在actions原有预留TODO位置修改购物车商品</li></ul> <p>落地代码：</p> <ul><li>编写修改购物车商品的API接口函数   <code>src/api/cart.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 修改购物车商品的状态和数量
 * @param {String} goods.skuId - 商品sku
 * @param {Boolean} goods.selected - 选中状态
 * @param {Integer} goods.count - 商品数量
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">updateCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">goods</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/member/cart/'</span> <span class="token operator">+</span> goods<span class="token punctuation">.</span>skuId<span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">,</span> goods<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>在actions原有预留TODO位置修改购物车商品  <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 修改购物车商品
</span><span class="token prefix unchanged"> </span><span class="token line">   updateCart (ctx, goods) {
</span><span class="token prefix unchanged"> </span><span class="token line">     // goods 中：必须有skuId，其他想修改的属性 selected  count
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">          updateCart(goods).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            return findCartList()
</span><span class="token prefix inserted">+</span><span class="token line">          }).then((data) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">            resolve()
</span><span class="token prefix inserted">+</span><span class="token line">          })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       } else {
</span></span></code></pre></div><h2 id="_22-登录后-全选反选"><a href="#_22-登录后-全选反选" class="header-anchor">#</a> 22-登录后-全选反选</h2> <blockquote><p>目标：完成有效商品的全选与反选功能</p></blockquote> <p>大概步骤：</p> <ul><li>准备全选与反选的API接口函数</li> <li>去完善actions，全选与反选的中的 登录 TODO 的地方</li></ul> <p>落的代码：</p> <p><code>src/api/cart.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 全选反选
 * @param {Boolean} selected - 选中状态
 * @param {Array&lt;string&gt;} ids - 有效商品skuId集合
 * @returns Promise
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">checkAllCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> selected<span class="token punctuation">,</span> ids <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/member/cart/selected'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> selected<span class="token punctuation">,</span> ids <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>src/store/modules/cart.js</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 做有效商品的全选&amp;反选
</span><span class="token prefix unchanged"> </span><span class="token line">   checkAllCart (ctx, selected) {
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">          const ids = ctx.getters.validList.map(item =&gt; item.skuId)
</span><span class="token prefix inserted">+</span><span class="token line">          checkAllCart({ selected, ids }).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            return findCartList()
</span><span class="token prefix inserted">+</span><span class="token line">          }).then((data) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">            resolve()
</span><span class="token prefix inserted">+</span><span class="token line">          })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       } else {
</span></span></code></pre></div><h2 id="_23-登录后-修改规格"><a href="#_23-登录后-修改规格" class="header-anchor">#</a> 23-登录后-修改规格</h2> <blockquote><p>目的：实现登录后的修改规格操作。</p></blockquote> <p>大致步骤：</p> <ul><li>由于没有修改接口的接口。通过删除旧商品，插入新商品，完成修改规格。</li> <li>去完善actions，修改规格的 登录 TODO 的地方</li></ul> <p>落地代码：</p> <ul><li>在actions原有预留TODO位置修改购物车商品规格  <code>src/store/module/cart.js</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // 修改sku规格函数
</span><span class="token prefix unchanged"> </span><span class="token line">   updateCartSku (ctx, { oldSkuId, newSku }) {
</span><span class="token prefix unchanged"> </span><span class="token line">     return new Promise((resolve, reject) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">       if (ctx.rootState.user.profile.token) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">          // 登录 TODO
</span><span class="token prefix inserted">+</span><span class="token line">          // 1. 获取原先商品的数量
</span><span class="token prefix inserted">+</span><span class="token line">          // 2. 删除原先商品
</span><span class="token prefix inserted">+</span><span class="token line">          // 3. 获取修改的skuId 和 原先商品数量 做一个加入购物车操作
</span><span class="token prefix inserted">+</span><span class="token line">          // 4. 更新列表
</span><span class="token prefix inserted">+</span><span class="token line">          const oldGoods = ctx.state.list.find(item =&gt; item.skuId === oldSkuId)
</span><span class="token prefix inserted">+</span><span class="token line">          deleteCart([oldSkuId]).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            return insertCart({ skuId: newSku.skuId, count: oldGoods.count })
</span><span class="token prefix inserted">+</span><span class="token line">          }).then(() =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            return findCartList()
</span><span class="token prefix inserted">+</span><span class="token line">          }).then((data) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">            ctx.commit('setCartList', data.result)
</span><span class="token prefix inserted">+</span><span class="token line">            resolve()
</span><span class="token prefix inserted">+</span><span class="token line">          })
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       }
</span></span></code></pre></div><h2 id="_24-下单结算"><a href="#_24-下单结算" class="header-anchor">#</a> 24-下单结算</h2> <blockquote><p>目的：去结算，未登录给确认框提示。</p></blockquote> <p>大致需求：</p> <ul><li>绑定下单结算按钮指定处理函数</li> <li>函数中：
<ul><li>判断是否选中有效商品。</li> <li>判断是否登录，给确认框提示，点击确认</li> <li>满足以上条件去填写订单(结算)页面。</li></ul></li> <li>member/xxx 的域名需要登录，所以做路由拦截。</li></ul> <p>落的代码：</p> <ul><li>下单结束点击后逻辑 <code>src/views/cart/index.vue</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Message <span class="token keyword">from</span> <span class="token string">'@/components/library/Message'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 跳转结算页面</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">goCheckout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1. 判断是否选择有效商品</span>
      <span class="token comment">// 2. 判断是否已经登录，未登录 弹窗提示</span>
      <span class="token comment">// 3. 进行跳转 （需要做访问权限控制）</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">'cart/selectedTotal'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'至少选中一件商品才能结算'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'下单结算需要登录，您是否去登录？'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 点击确认</span>
          router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/member/checkout'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/member/checkout'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> checkOne<span class="token punctuation">,</span> checkAll<span class="token punctuation">,</span> deleteCart<span class="token punctuation">,</span> batchDeleteCart<span class="token punctuation">,</span> changeCount<span class="token punctuation">,</span> updateCartSku<span class="token punctuation">,</span> goCheckout <span class="token punctuation">}</span>  
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XtxButton</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goCheckout()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>下单结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XtxButton</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>路由拦截 <code>src/router/index.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 前置导航守卫</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 用户信息</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile
  <span class="token comment">// 跳转去member开头的地址却没有登录</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/member'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> query<span class="token operator">:</span> <span class="token punctuation">{</span> redirectUrl<span class="token operator">:</span> to<span class="token punctuation">.</span>fullPath <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/erabbit-client-pc-document/assets/js/app.948bdee4.js" defer></script><script src="/erabbit-client-pc-document/assets/js/2.e30d490f.js" defer></script><script src="/erabbit-client-pc-document/assets/js/6.8b45773c.js" defer></script>
  </body>
</html>
